name: Smoke Test

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  smoke-test:
    name: Smoke Test
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Validate manifest and check JS files
        run: |
          node -e "
            const fs = require('fs');

            // Parse and validate manifest
            const manifest = JSON.parse(fs.readFileSync('manifest.json', 'utf8'));
            if (manifest.manifest_version !== 3) {
              throw new Error('manifest_version must be 3');
            }
            console.log('Manifest OK:', manifest.name, 'v' + manifest.version);

            // Check all JS files referenced in manifest
            const jsFiles = [
              manifest.background?.service_worker,
              ...(manifest.content_scripts?.flatMap(cs => cs.js) || [])
            ].filter(Boolean);

            for (const file of jsFiles) {
              require('child_process').execSync('node -c ' + file, { stdio: 'inherit' });
              console.log('Syntax OK:', file);
            }
          "
